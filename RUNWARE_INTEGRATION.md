# Runware API Integration Guide

## Overview

The SOLACE Breathing Room Generator uses Runware ML's text-to-image API for custom room generation. Users can create custom rooms with Flux or Seedream XL models, save them as reusable templates, and use them in breathing room videos.

## Features

✅ **Unlimited Custom Prompts** - Generate any room style you can imagine  
✅ **Model Selection** - Choose between Flux (stable, cinematic) or Seedream XL (atmospheric)  
✅ **Custom Negative Prompts** - Control what to avoid in generation  
✅ **Template Saving** - Save custom rooms as reusable templates  
✅ **Auto-Loading** - Custom templates automatically appear in the dropdown  
✅ **JSON-Based** - Templates are portable and editable  
✅ **Image-Only Generation** - All animation is done in-app with FFmpeg

## Setup

1. **Get Runware API Key**
   - Sign up at [Runware.ai](https://runware.ai)
   - Navigate to API settings
   - Generate an API key

2. **Configure Environment**
   ```bash
   cp .env.local.example .env.local
   ```
   
   Edit `.env.local`:
   ```
   RUNWARE_API_KEY=your_api_key_here
   ```

## Models

### Flux (`black-forest-labs/FLUX.1-dev`)
- **Best for:** Stable, cinematic rooms
- **Style:** High quality, consistent results
- **Use when:** You want reliable, professional-looking rooms

### Seedream XL (`cagliostrolab/seedream2-xl`)
- **Best for:** Atmospheric, environmental vibes
- **Style:** More artistic, moody atmospheres
- **Use when:** You want unique, atmospheric rooms

## Usage

### Generating Custom Rooms

1. **In the Editor:**
   - Select AI Model (Flux or Seedream)
   - Select Room Style (built-in or Custom Prompt)
   - If Custom: Enter your prompt
   - Optionally add negative prompt
   - Click "Generate Background (Runware)"

2. **Saving as Template:**
   - Check "Save as reusable Room Template"
   - Enter a name (e.g., "My Dream Library")
   - Generate - template will be saved with model selection

3. **Using Saved Templates:**
   - Saved templates appear under "Your Custom Rooms"
   - Model is locked to template's original selection
   - Select to use immediately

## API Endpoints

### POST `/api/generate-room`

Generate a new room image using Runware API.

**Request:**
```json
{
  "style": "custom",
  "customPrompt": "minimalist library with warm lighting",
  "customNegativePrompt": "people, text",
  "customName": "My Library",
  "saveAsTemplate": true,
  "model": "flux"
}
```

**Response:**
```json
{
  "url": "/generated/rooms/generated-room-16748393.png",
  "templateSaved": true,
  "templateName": "My-Library"
}
```

### GET `/api/templates`

Load all custom templates.

**Response:**
```json
{
  "templates": [
    {
      "name": "My Library",
      "prompt": "minimalist library...",
      "negativePrompt": "people, text",
      "style": "custom",
      "model": "flux",
      "createdAt": "2024-01-01T00:00:00Z",
      "imageUrl": "/generated/rooms/..."
    }
  ]
}
```

## Template Structure

Custom templates are stored as JSON files in `/templates/rooms/custom/`:

```json
{
  "name": "My Dream Room",
  "prompt": "your prompt here",
  "negativePrompt": "optional negative prompt",
  "style": "custom",
  "model": "flux",
  "createdAt": "2024-01-01T00:00:00Z",
  "imageUrl": "/generated/rooms/generated-room-123.png"
}
```

## File Structure

```
templates/
├── rooms/
│   ├── default/
│   │   ├── zen.json
│   │   ├── brutalist.json
│   │   ├── neon.json
│   │   └── scifi.json
│   └── custom/
│       ├── My-Library.json
│       └── Dream-Room.json
public/
└── generated/
    └── rooms/
        ├── generated-room-16748393.png
        └── generated-room-16748394.png
```

## Image Handling

- Generated images are saved to `/public/generated/rooms/`
- Images are automatically cropped/fitted to 16:9 aspect ratio
- Preview component handles different image sizes gracefully
- Images work seamlessly with breathing animations

## Animation (In-App Only)

**Important:** All animation is done in-app using FFmpeg:
- ✅ Breathing animation
- ✅ Brightness pulse
- ✅ Warmth shift
- ✅ All visual effects

**NOT** generated by AI - Runware only generates static images.

## Error Handling

The system handles:
- Missing API keys (clear error message)
- Invalid prompts (validation before API call)
- API failures (user-friendly error display)
- File system errors (graceful degradation)

## Troubleshooting

**"RUNWARE_API_KEY environment variable is not set"**
- Ensure `.env.local` exists and contains `RUNWARE_API_KEY`
- Restart dev server after adding env vars

**"Custom prompt is required"**
- Make sure prompt field is not empty when using custom style

**Templates not loading**
- Check `/templates/rooms/custom/` directory exists
- Verify JSON files are valid
- Check server logs for file system errors

**Images not displaying**
- Verify images are saved to `/public/generated/rooms/`
- Check file permissions
- Ensure image URLs are correct

**Model selection locked**
- When using saved templates, model is locked to template's original selection
- Create new custom prompt to change model

